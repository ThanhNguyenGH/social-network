<% if (!csrfToken) { %>
  <div class="max-w-md mx-auto mt-4 px-4 py-3 rounded-lg bg-red-100 text-red-800 border border-red-300 shadow">
    <p><i class="fas fa-exclamation-triangle mr-2"></i>CSRF token is missing. Please refresh the page or contact support.</p>
  </div>
<% } %>

<% if (errors && errors.length > 0) { %>
  <div class="max-w-md mx-auto mt-4 px-4 py-3 rounded-lg bg-red-100 text-red-800 border border-red-300 shadow">
    <% errors.forEach(error => { %>
      <p><i class="fas fa-exclamation-circle mr-2"></i><%= error.msg %></p>
    <% }) %>
  </div>
<% } %>

<input type="hidden" name="_csrf" value="<%= csrfToken %>">
<input type="hidden" name="userId" value="<%= user._id %>">

<form action="/users/edit" method="POST" enctype="multipart/form-data" class="max-w-md mx-auto mt-6 bg-white p-6 rounded-xl shadow-lg ring-1 ring-gray-200">
  <input type="hidden" name="_csrf" value="<%= csrfToken %>">

  <h2 class="text-xl font-semibold mb-4 text-gray-700">Cập nhật thông tin người dùng</h2>

  <div class="mb-4">
    <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Tên người dùng</label>
    <input type="text" name="username" id="username" value="<%= user.username %>" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
  </div>

  <div class="mb-4">
    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
    <input type="email" name="email" id="email" value="<%= user.email %>" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
  </div>

  <div class="mb-4">
    <label for="bio" class="block text-sm font-medium text-gray-700 mb-1">Giới thiệu</label>
    <textarea name="bio" id="bio" rows="4" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"><%= user.bio || '' %></textarea>
  </div>

  <div class="mb-4">
    <label for="avatar" class="block text-sm font-medium text-gray-700 mb-1">Ảnh đại diện</label>
    <input type="file" name="avatar" id="avatar" accept="image/jpeg,image/png" class="block w-full text-sm text-gray-500">
  </div>

  <button type="submit" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition duration-200 shadow">
    <i class="fas fa-save mr-2"></i>Lưu thay đổi
  </button>
</form>
